<!DOCTYPE html>
<html>
<head>
  <title>Roblox at Home</title>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <style>
    html, body { margin: 0; overflow: hidden; height: 100%; }
    canvas { width: 100%; height: 100%; display: block; }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    const scene = new BABYLON.Scene(engine);
    const camera = new BABYLON.ArcRotateCamera("camera", Math.PI/2, Math.PI/4, 10, BABYLON.Vector3.Zero(), scene);
    camera.attachControl(canvas, true);
    new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

    const graphics = {
      new: function(type, props = {}) {
        let mesh;
        switch(type) {
          case "cube":
            mesh = BABYLON.MeshBuilder.CreateBox("cube", {}, scene);
            break;
          case "sphere":
            mesh = BABYLON.MeshBuilder.CreateSphere("sphere", {}, scene);
            break;
        }
        if (mesh && props.x !== undefined) mesh.position.x = props.x;
        if (mesh && props.y !== undefined) mesh.position.y = props.y;
        if (mesh && props.z !== undefined) mesh.position.z = props.z;
        return mesh;
      }
    };

    function wait(seconds) {
      return new Promise(resolve => setTimeout(resolve, seconds * 1000));
    }

    async function runScript(code) {
      const lines = code.split("\n");
      for (let line of lines) {
        line = line.trim();
        if (line.startsWith("wait(")) {
          const t = parseFloat(line.match(/wait\(([^)]+)\)/)[1]);
          await wait(t);
        } else if (line.startsWith("graphics.new")) {
          const match = line.match(/graphics\.new\("([^"]+)",\s*(\{.*\})\)/);
          if (match) {
            const type = match[1];
            const props = eval("(" + match[2] + ")");
            graphics.new(type, props);
          }
        } else if (line.startsWith("print(")) {
          const msg = line.match(/print\(([^)]+)\)/)[1];
          console.log(eval(msg));
        }
      }
    }

    // ðŸ§ª Load cube.lua and run it
    fetch("cube.lua")
      .then(res => res.text())
      .then(code => runScript(code));

    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());
  </script>
</body>
</html>

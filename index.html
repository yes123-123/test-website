<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lua Shape Scene</title>
  <style>
    body { background: #111; color: #eee; font-family: monospace; padding: 20px; }
    canvas { background: #222; display: block; margin: 20px auto; }
  </style>
  <script src="https://unpkg.com/fengari-web/dist/fengari-web.js"></script>
</head>
<body>
  <h1>Lua Shape Scene</h1>
  <canvas id="scene" width="800" height="600"></canvas>
  <pre id="output"></pre>

  <script>
    const canvas = document.getElementById("scene");
    const ctx = canvas.getContext("2d");
    const output = document.getElementById("output");
    const scene = [];

    const Vector3 = {
      new: (x, y, z) => ({ x, y, z })
    };

    const Color3 = {
      new: (r, g, b) => ({ r, g, b })
    };

    // List of Lua files in the folder
    const luaFiles = ["lua.lua", "cube.lua", "sphere.lua", "wedge.lua"]; // Add more as needed

    luaFiles.forEach(file => {
      fetch(file)
        .then(res => res.text())
        .then(luaCode => {
          const self = {
            Position: { x: 0, y: 0, z: 0 },
            Size: { x: 1, y: 1, z: 1 },
            Color: { r: 1, g: 1, b: 1 },
            Shape: null
          };

          const set = {
            self: shape => { self.Shape = shape; }
          };

          fengari.load(luaCode, {
            env: fengari.interop.tojs({ set, self, Vector3, Color3 }),
            stdout: text => output.textContent += text
          })();

          scene.push(self);
          renderScene();
        });
    });

    function renderScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      output.textContent += "\n--- Scene ---\n";

      scene.forEach((obj, i) => {
        output.textContent += `#${i + 1} ${obj.Shape} at (${obj.Position.x}, ${obj.Position.y}, ${obj.Position.z})\n`;

        if (obj.Shape === "cube") {
          ctx.fillStyle = `rgb(${obj.Color.r * 255}, ${obj.Color.g * 255}, ${obj.Color.b * 255})`;
          ctx.fillRect(
            canvas.width / 2 + obj.Position.x * 10,
            canvas.height / 2 + obj.Position.y * 10,
            obj.Size.x * 20,
            obj.Size.y * 20
          );
        }
        // Add other shapes here (sphere, wedge, etc.)
      });
    }
  </script>
</body>
</html>
